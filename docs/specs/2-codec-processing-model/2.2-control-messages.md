# 2.2. Control Messages

A control message defines a sequence of steps corresponding to a method invocation on a [codec](#codec) instance (e.g. `encode()`).

A control message queue is a [queue](https://infra.spec.whatwg.org/#queue) of [control messages](#control-message). Each [codec](#codec) instance has a control message queue stored in an internal slot named \[\[control message queue\]\].

Queuing a control message means [enqueuing](https://infra.spec.whatwg.org/#queue-enqueue) the message to a [codec](#codec)’s [\[\[control message queue\]\]](#control-message-queue-slot). Invoking codec methods will generally queue a control message to schedule work.

Running a control message means performing a sequence of steps specified by the method that enqueued the message.

The steps of a given control message can block processing later messages in the control message queue. Each [codec](#codec) instance has a boolean internal slot named \[\[message queue blocked\]\] that is set to `true` when this occurs. A blocking message will conclude by setting [\[\[message queue blocked\]\]](#message-queue-blocked) to `false` and rerunning the [Process the control message queue](#process-the-control-message-queue) steps.

All control messages will return either `"processed"` or `"not processed"`. Returning `"processed"` indicates the message steps are being (or have been) executed and the message may be removed from the [control message queue](#control-message-queue). `"not processed"` indicates the message must not be processed at this time and should remain in the [control message queue](#control-message-queue) to be retried later.

To Process the control message queue, run these steps:

1.  While [\[\[message queue blocked\]\]](#message-queue-blocked) is `false` and [\[\[control message queue\]\]](#control-message-queue-slot) is not empty:
    1.  Let front message be the first message in [\[\[control message queue\]\]](#control-message-queue-slot).
    2.  Let outcome be the result of running the [control message steps](#running-a-control-message) described by front message.
    3.  If outcome equals `"not processed"`, break.
    4.  Otherwise, dequeue front message from the [\[\[control message queue\]\]](#control-message-queue-slot).

---

[← Back to 2. Codec Processing Model](../2-codec-processing-model/TOC.md)
