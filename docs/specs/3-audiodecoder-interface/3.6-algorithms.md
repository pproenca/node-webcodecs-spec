# 3.6. Algorithms

**Schedule Dequeue Event**
: 1.  If [`[[dequeue event scheduled]]`](#dom-audiodecoder-dequeue-event-scheduled-slot) equals `true`, return.
    
2.  Assign `true` to [`[[dequeue event scheduled]]`](#dom-audiodecoder-dequeue-event-scheduled-slot).
    
3.  [Queue a task](https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task) to run the following steps:
    
    1.  Fire a simple event named [`dequeue`](#eventdef-audiodecoder-dequeue) at [this](https://webidl.spec.whatwg.org/#this).
        
    2.  Assign `false` to [`[[dequeue event scheduled]]`](#dom-audiodecoder-dequeue-event-scheduled-slot).

**Output AudioData (with outputs)**
: Run these steps:

1.  For each output in outputs:
    
    1.  Let data be an [`AudioData`](#audiodata), initialized as follows:
        
        1.  Assign `false` to [`[[Detached]]`](https://html.spec.whatwg.org/multipage/structured-data.html#detached).
            
        2.  Let resource be the [media resource](#media-resource) described by output.
            
        3.  Let resourceReference be a reference to resource.
            
        4.  Assign resourceReference to [`[[resource reference]]`](#dom-audiodata-resource-reference-slot).
            
        5.  Let timestamp be the [`[[timestamp]]`](#dom-encodedaudiochunk-timestamp-slot) of the [`EncodedAudioChunk`](#encodedaudiochunk) associated with output.
            
        6.  Assign timestamp to [`[[timestamp]]`](#dom-audiodata-timestamp-slot).
            
        7.  If output uses a recognized [`AudioSampleFormat`](#enumdef-audiosampleformat), assign that format to [`[[format]]`](#dom-audiodata-format-slot). Otherwise, assign `null` to [`[[format]]`](#dom-audiodata-format-slot).
            
        8.  Assign values to [`[[sample rate]]`](#dom-audiodata-sample-rate-slot), [`[[number of frames]]`](#dom-audiodata-number-of-frames-slot), and [`[[number of channels]]`](#dom-audiodata-number-of-channels-slot) as determined by output.
            
    2.  Invoke [`[[output callback]]`](#dom-audiodecoder-output-callback-slot) with data.

**Reset AudioDecoder (with exception)**
: Run these steps:

1.  If [`[[state]]`](#dom-audiodecoder-state-slot) is `"closed"`, throw an [`InvalidStateError`](https://webidl.spec.whatwg.org/#invalidstateerror).
    
2.  Set [`[[state]]`](#dom-audiodecoder-state-slot) to `"unconfigured"`.
    
3.  Signal [`[[codec implementation]]`](#dom-audiodecoder-codec-implementation-slot) to cease producing output for the previous configuration.
    
4.  Remove all [control messages](#control-message) from the [`[[control message queue]]`](#dom-audiodecoder-control-message-queue-slot).
    
5.  If [`[[decodeQueueSize]]`](#dom-audiodecoder-decodequeuesize-slot) is greater than zero:
    
    1.  Set [`[[decodeQueueSize]]`](#dom-audiodecoder-decodequeuesize-slot) to zero.
        
    2.  Run the [Schedule Dequeue Event](#audiodecoder-schedule-dequeue-event) algorithm.
        
6.  For each promise in [`[[pending flush promises]]`](#dom-audiodecoder-pending-flush-promises-slot):
    
    1.  Reject promise with exception.
        
    2.  Remove promise from [`[[pending flush promises]]`](#dom-audiodecoder-pending-flush-promises-slot).

**Close AudioDecoder (with exception)**
: Run these steps:

1.  Run the [Reset AudioDecoder](#reset-audiodecoder) algorithm with exception.
    
2.  Set [`[[state]]`](#dom-audiodecoder-state-slot) to `"closed"`.
    
3.  Clear [`[[codec implementation]]`](#dom-audiodecoder-codec-implementation-slot) and release associated [system resources](#system-resources).
    
4.  If exception is not an [`AbortError`](https://webidl.spec.whatwg.org/#aborterror) [`DOMException`](https://webidl.spec.whatwg.org/#idl-DOMException), invoke the [`[[error callback]]`](#dom-audiodecoder-error-callback-slot) with exception.

---

[‚Üê Back to 3. AudioDecoder Interface](../3-audiodecoder-interface/TOC.md)
