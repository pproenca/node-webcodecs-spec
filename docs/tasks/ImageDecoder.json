{
  "interface": "ImageDecoder",
  "type": "interface",
  "source": {
    "idl": "spec/context/_webcodecs.idl#L515-L528",
    "spec": "spec/context/ImageDecoder.md"
  },
  "extendedAttributes": [
    "Exposed=[{\"value\":\"Window\"},{\"value\":\"DedicatedWorker\"}]",
    "SecureContext"
  ],
  "files": {
    "cppHeader": "src/ImageDecoder.h",
    "cppImpl": "src/ImageDecoder.cpp",
    "tsWrapper": "lib/ImageDecoder.ts",
    "tests": "test/imagedecoder.test.ts"
  },
  "features": [
    {
      "id": "ImageDecoder.constructor",
      "category": "constructor",
      "name": "constructor(init: ImageDecoderInit)",
      "description": "Create ImageDecoder instance",
      "codeLinks": {
        "declaration": {
          "file": "src/ImageDecoder.h",
          "line": 1
        },
        "implementation": {
          "file": "src/ImageDecoder.cpp",
          "line": 25,
          "endLine": 35
        },
        "tsBinding": {
          "file": "lib/ImageDecoder.ts",
          "line": 39,
          "endLine": 42
        }
      },
      "algorithmRef": "spec/context/ImageDecoder.md#constructor",
      "algorithmSteps": [
        "NOTE: Calling `[decode()](#dom-imagedecoder-decode)` on the constructed `[ImageDecoder](#imagedecoder)` will trigger a `[NotSupportedError](https://webidl.spec.whatwg.org/#notsupportederror)` if the User Agent does not support type. Authors are encouraged to first check support by calling `[isTypeSupported()](#dom-imagedecoder-istypesupported)` with type. User Agents don’t have to support any particular type.",
        "When invoked, run these steps:",
        "If init is not [valid ImageDecoderInit](#valid-imagedecoderinit), throw a `[TypeError](https://webidl.spec.whatwg.org/#exceptiondef-typeerror)`.",
        "If init.`[transfer](#dom-imagedecoderinit-transfer)` contains more than one reference to the same `[ArrayBuffer](https://webidl.spec.whatwg.org/#idl-ArrayBuffer)`, then throw a `[DataCloneError](https://webidl.spec.whatwg.org/#datacloneerror)` `[DOMException](https://webidl.spec.whatwg.org/#idl-DOMException)`.",
        "For each transferable in init.`[transfer](#dom-imagedecoderinit-transfer)`:",
        "If `[Detached](https://html.spec.whatwg.org/multipage/structured-data.html#detached)` internal slot is `true`, then throw a `[DataCloneError](https://webidl.spec.whatwg.org/#datacloneerror)` `[DOMException](https://webidl.spec.whatwg.org/#idl-DOMException)`.",
        "Let d be a new `[ImageDecoder](#imagedecoder)` object. In the steps below, all mentions of `[ImageDecoder](#imagedecoder)` members apply to d unless stated otherwise.",
        "Assign a new [queue](https://infra.spec.whatwg.org/#queue) to `[control message queue](#dom-imagedecoder-control-message-queue-slot)`.",
        "Assign `false` to `[message queue blocked](#dom-imagedecoder-message-queue-blocked-slot)`.",
        "Assign the result of starting a new [parallel queue](https://html.spec.whatwg.org/multipage/infrastructure.html#parallel-queue) to `[codec work queue](#dom-imagedecoder-codec-work-queue-slot)`.",
        "Assign `[ImageTrackList](#dom-imagedecoder-imagetracklist-slot)` a new `[ImageTrackList](#imagetracklist)` initialized as follows:",
        "Assign a new [list](https://infra.spec.whatwg.org/#list) to `[track list](#dom-imagetracklist-track-list-slot)`.",
        "Assign `-1` to `[selected index](#dom-imagetracklist-selected-index-slot)`.",
        "Assign `[type](#dom-imagedecoderinit-type)` to `[type](#dom-imagedecoder-type-slot)`.",
        "Assign `null` to `[codec implementation](#dom-imagedecoder-codec-implementation-slot)`.",
        "If `init.preferAnimation` [exists](https://infra.spec.whatwg.org/#map-exists), assign `init.preferAnimation` to the `[prefer animation](#dom-imagedecoder-prefer-animation-slot)` internal slot. Otherwise, assign 'null' to `[prefer animation](#dom-imagedecoder-prefer-animation-slot)` internal slot.",
        "Assign a new [list](https://infra.spec.whatwg.org/#list) to `[pending decode promises](#dom-imagedecoder-pending-decode-promises-slot)`.",
        "Assign `-1` to `[internal selected track index](#dom-imagedecoder-internal-selected-track-index-slot)`.",
        "Assign `false` to `[tracks established](#dom-imagedecoder-tracks-established-slot)`.",
        "Assign `false` to `[closed](#dom-imagedecoder-closed-slot)`.",
        "Assign a new [map](https://infra.spec.whatwg.org/#ordered-map) to `[progressive frame generations](#dom-imagedecoder-progressive-frame-generations-slot)`.",
        "If init’s `[data](#dom-imagedecoderinit-data)` member is of type `[ReadableStream](https://streams.spec.whatwg.org/#readablestream)`:",
        "Assign a new [list](https://infra.spec.whatwg.org/#list) to `[encoded data](#dom-imagedecoder-encoded-data-slot)`.",
        "Assign `false` to `[complete](#dom-imagedecoder-complete-slot)`",
        "[Queue a control message](#enqueues-a-control-message) to [configure the image decoder](#configure-the-image-decoder) with init.",
        "[Process the control message queue](#process-the-control-message-queue).",
        "Let reader be the result of [getting a reader](https://streams.spec.whatwg.org/#readablestream-get-a-reader) for `[data](#dom-imagedecoderinit-data)`.",
        "In parallel, perform the [Fetch Stream Data Loop](#imagedecoder-fetch-stream-data-loop) on d with reader.",
        "Otherwise:",
        "Assert that `init.data` is of type `[BufferSource](https://webidl.spec.whatwg.org/#BufferSource)`.",
        "If init.`[transfer](#dom-imagedecoderinit-transfer)` contains an `[ArrayBuffer](https://webidl.spec.whatwg.org/#idl-ArrayBuffer)` referenced by init.`[data](#dom-imagedecoderinit-data)` the User Agent _MAY_ choose to:",
        "Let `[encoded data](#dom-imagedecoder-encoded-data-slot)` reference bytes in data representing an encoded image.",
        "Otherwise:",
        "Assign a copy of `init.data` to `[encoded data](#dom-imagedecoder-encoded-data-slot)`.",
        "Assign `true` to `[complete](#dom-imagedecoder-complete-slot)`.",
        "Resolve `[completed promise](#dom-imagedecoder-completed-promise-slot)`.",
        "Queue a control message to [configure the image decoder](#configure-the-image-decoder) with init.",
        "Queue a control message to [decode track metadata](#decode-track-metadata).",
        "[Process the control message queue](#process-the-control-message-queue).",
        "For each transferable in init.`[transfer](#dom-imagedecoderinit-transfer)`:",
        "Perform [DetachArrayBuffer](https://tc39.es/ecma262/#sec-detacharraybuffer) on transferable",
        "return d.",
        "[Running a control message](#running-a-control-message) to configure the image decoder means running these steps:",
        "Let supported be the result of running the [Check Type Support](#imagedecoder-check-type-support) algorithm with `init.type`.",
        "If supported is `false`, run the [Close ImageDecoder](#imagedecoder-close-imagedecoder) algorithm with a `[NotSupportedError](https://webidl.spec.whatwg.org/#notsupportederror)` `[DOMException](https://webidl.spec.whatwg.org/#idl-DOMException)` and return \"processed\".",
        "Otherwise, assign the `[codec implementation](#dom-imagedecoder-codec-implementation-slot)` internal slot with an implementation supporting `init.type`",
        "Assign `true` to `[message queue blocked](#dom-imagedecoder-message-queue-blocked-slot)`.",
        "Enqueue the following steps to the `[codec work queue](#dom-imagedecoder-codec-work-queue-slot)`:",
        "Configure `[codec implementation](#dom-imagedecoder-codec-implementation-slot)` in accordance with the values given for `[colorSpaceConversion](#dom-imagedecoderinit-colorspaceconversion)`, `[desiredWidth](#dom-imagedecoderinit-desiredwidth)`, and `[desiredHeight](#dom-imagedecoderinit-desiredheight)`.",
        "Assign `false` to `[message queue blocked](#dom-imagedecoder-message-queue-blocked-slot)`.",
        "[Queue a task](https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task) to [Process the control message queue](#process-the-control-message-queue).",
        "Return \"processed\".",
        "[Running a control message](#running-a-control-message) to decode track metadata means running these steps:",
        "Enqueue the following steps to the `[codec work queue](#dom-imagedecoder-codec-work-queue-slot)`:",
        "Run the [Establish Tracks](#imagedecoder-establish-tracks) algorithm."
      ],
      "steps": [
        {
          "id": "ImageDecoder.constructor.cpp-impl",
          "description": "C++: Implement constructor with parameter validation",
          "passes": false
        },
        {
          "id": "ImageDecoder.constructor.cpp-init",
          "description": "C++: Initialize internal state slots",
          "passes": false
        },
        {
          "id": "ImageDecoder.constructor.ts-binding",
          "description": "TS: Wire TypeScript wrapper to native constructor",
          "passes": false
        },
        {
          "id": "ImageDecoder.constructor.test",
          "description": "Test: Verify constructor creates valid instance",
          "passes": false
        }
      ],
      "passes": false
    },
    {
      "id": "ImageDecoder.type",
      "category": "attribute",
      "name": "type",
      "description": "Readonly attribute",
      "returnType": "DOMString",
      "readonly": true,
      "codeLinks": {
        "declaration": {
          "file": "src/ImageDecoder.h",
          "line": 28
        },
        "implementation": {
          "file": "src/ImageDecoder.cpp",
          "line": 48,
          "endLine": 51
        },
        "tsBinding": {
          "file": "lib/ImageDecoder.ts",
          "line": 44,
          "endLine": 46
        }
      },
      "algorithmRef": "spec/context/ImageDecoder.md#attributes",
      "algorithmSteps": [],
      "steps": [
        {
          "id": "ImageDecoder.type.cpp-getter",
          "description": "C++: Implement GetType() returning DOMString",
          "passes": false
        },
        {
          "id": "ImageDecoder.type.ts-binding",
          "description": "TS: Wire getter to native",
          "passes": false
        },
        {
          "id": "ImageDecoder.type.test",
          "description": "Test: Verify initial value and behavior",
          "passes": false
        }
      ],
      "passes": false
    },
    {
      "id": "ImageDecoder.complete",
      "category": "attribute",
      "name": "complete",
      "description": "Readonly attribute",
      "returnType": "boolean",
      "readonly": true,
      "codeLinks": {
        "declaration": {
          "file": "src/ImageDecoder.h",
          "line": 29
        },
        "implementation": {
          "file": "src/ImageDecoder.cpp",
          "line": 53,
          "endLine": 56
        },
        "tsBinding": {
          "file": "lib/ImageDecoder.ts",
          "line": 47,
          "endLine": 49
        }
      },
      "algorithmRef": "spec/context/ImageDecoder.md#attributes",
      "algorithmSteps": [],
      "steps": [
        {
          "id": "ImageDecoder.complete.cpp-getter",
          "description": "C++: Implement GetComplete() returning boolean",
          "passes": false
        },
        {
          "id": "ImageDecoder.complete.ts-binding",
          "description": "TS: Wire getter to native",
          "passes": false
        },
        {
          "id": "ImageDecoder.complete.test",
          "description": "Test: Verify initial value and behavior",
          "passes": false
        }
      ],
      "passes": false
    },
    {
      "id": "ImageDecoder.completed",
      "category": "attribute",
      "name": "completed",
      "description": "Readonly attribute",
      "returnType": "undefined",
      "readonly": true,
      "codeLinks": {
        "declaration": {
          "file": "src/ImageDecoder.h",
          "line": 30
        },
        "implementation": {
          "file": "src/ImageDecoder.cpp",
          "line": 58,
          "endLine": 61
        },
        "tsBinding": {
          "file": "lib/ImageDecoder.ts",
          "line": 50,
          "endLine": 52
        }
      },
      "algorithmRef": "spec/context/ImageDecoder.md#attributes",
      "algorithmSteps": [],
      "steps": [
        {
          "id": "ImageDecoder.completed.cpp-getter",
          "description": "C++: Implement GetCompleted() returning undefined",
          "passes": false
        },
        {
          "id": "ImageDecoder.completed.ts-binding",
          "description": "TS: Wire getter to native",
          "passes": false
        },
        {
          "id": "ImageDecoder.completed.test",
          "description": "Test: Verify initial value and behavior",
          "passes": false
        }
      ],
      "passes": false
    },
    {
      "id": "ImageDecoder.tracks",
      "category": "attribute",
      "name": "tracks",
      "description": "Readonly attribute",
      "returnType": "ImageTrackList",
      "readonly": true,
      "codeLinks": {
        "declaration": {
          "file": "src/ImageDecoder.h",
          "line": 31
        },
        "implementation": {
          "file": "src/ImageDecoder.cpp",
          "line": 63,
          "endLine": 66
        },
        "tsBinding": {
          "file": "lib/ImageDecoder.ts",
          "line": 53,
          "endLine": 55
        }
      },
      "algorithmRef": "spec/context/ImageDecoder.md#attributes",
      "algorithmSteps": [],
      "steps": [
        {
          "id": "ImageDecoder.tracks.cpp-getter",
          "description": "C++: Implement GetTracks() returning ImageTrackList",
          "passes": false
        },
        {
          "id": "ImageDecoder.tracks.ts-binding",
          "description": "TS: Wire getter to native",
          "passes": false
        },
        {
          "id": "ImageDecoder.tracks.test",
          "description": "Test: Verify initial value and behavior",
          "passes": false
        }
      ],
      "passes": false
    },
    {
      "id": "ImageDecoder.decode",
      "category": "method",
      "name": "decode(options: ImageDecodeOptions)",
      "description": "Enqueues a control message to decode the frame according to options.",
      "returnType": "ImageDecodeResult",
      "codeLinks": {
        "declaration": {
          "file": "src/ImageDecoder.h",
          "line": 35
        },
        "implementation": {
          "file": "src/ImageDecoder.cpp",
          "line": 71,
          "endLine": 81
        },
        "tsBinding": {
          "file": "lib/ImageDecoder.ts",
          "line": 57,
          "endLine": 59
        }
      },
      "algorithmRef": "spec/context/ImageDecoder.md#decode",
      "algorithmSteps": [
        "Enqueues a control message to decode the frame according to options.",
        "When invoked, run these steps:",
        "If `[closed](#dom-imagedecoder-closed-slot)` is `true`, return a `[Promise](https://webidl.spec.whatwg.org/#idl-promise)` rejected with an `[InvalidStateError](https://webidl.spec.whatwg.org/#invalidstateerror)` `[DOMException](https://webidl.spec.whatwg.org/#idl-DOMException)`.",
        "If `[ImageTrackList](#dom-imagedecoder-imagetracklist-slot)`’s `[selected index](#dom-imagetracklist-selected-index-slot)` is '-1', return a `[Promise](https://webidl.spec.whatwg.org/#idl-promise)` rejected with an `[InvalidStateError](https://webidl.spec.whatwg.org/#invalidstateerror)` `[DOMException](https://webidl.spec.whatwg.org/#idl-DOMException)`.",
        "If options is `undefined`, assign a new `[ImageDecodeOptions](#dictdef-imagedecodeoptions)` to options.",
        "Let promise be a new `[Promise](https://webidl.spec.whatwg.org/#idl-promise)`.",
        "Append promise to `[pending decode promises](#dom-imagedecoder-pending-decode-promises-slot)`.",
        "[Queue a control message](#enqueues-a-control-message) to decode the image with options, and promise.",
        "[Process the control message queue](#process-the-control-message-queue).",
        "Return promise.",
        "[Running a control message](#running-a-control-message) to decode the image means running these steps:",
        "Enqueue the following steps to the `[codec work queue](#dom-imagedecoder-codec-work-queue-slot)`:",
        "Wait for `[tracks established](#dom-imagedecoder-tracks-established-slot)` to become `true`.",
        "If options.`[completeFramesOnly](#dom-imagedecodeoptions-completeframesonly)` is `false` and the image is a [Progressive Image](#progressive-image) for which the User Agent supports progressive decoding, run the [Decode Progressive Frame](#imagedecoder-decode-progressive-frame) algorithm with options.`[frameIndex](#dom-imagedecodeoptions-frameindex)` and promise.",
        "Otherwise, run the [Decode Complete Frame](#imagedecoder-decode-complete-frame) algorithm with options.`[frameIndex](#dom-imagedecodeoptions-frameindex)` and promise."
      ],
      "steps": [
        {
          "id": "ImageDecoder.decode.cpp-impl",
          "description": "C++: Implement method logic per W3C spec algorithm",
          "passes": false
        },
        {
          "id": "ImageDecoder.decode.cpp-errors",
          "description": "C++: Handle error cases with proper DOMException types",
          "passes": false
        },
        {
          "id": "ImageDecoder.decode.ts-binding",
          "description": "TS: Wire method to native implementation",
          "passes": false
        },
        {
          "id": "ImageDecoder.decode.test-happy",
          "description": "Test: Write test case for happy path",
          "passes": false
        },
        {
          "id": "ImageDecoder.decode.test-errors",
          "description": "Test: Write test case for error conditions",
          "passes": false
        }
      ],
      "passes": false
    },
    {
      "id": "ImageDecoder.reset",
      "category": "method",
      "name": "reset()",
      "description": "Immediately aborts all pending work.",
      "returnType": "undefined",
      "codeLinks": {
        "declaration": {
          "file": "src/ImageDecoder.h",
          "line": 36
        },
        "implementation": {
          "file": "src/ImageDecoder.cpp",
          "line": 83,
          "endLine": 93
        },
        "tsBinding": {
          "file": "lib/ImageDecoder.ts",
          "line": 60,
          "endLine": 62
        }
      },
      "algorithmRef": "spec/context/ImageDecoder.md#reset",
      "algorithmSteps": [
        "Immediately aborts all pending work.",
        "When invoked, run the [Reset ImageDecoder](#imagedecoder-reset-imagedecoder) algorithm with an `[AbortError](https://webidl.spec.whatwg.org/#aborterror)` `[DOMException](https://webidl.spec.whatwg.org/#idl-DOMException)`."
      ],
      "steps": [
        {
          "id": "ImageDecoder.reset.cpp-impl",
          "description": "C++: Implement method logic per W3C spec algorithm",
          "passes": false
        },
        {
          "id": "ImageDecoder.reset.cpp-errors",
          "description": "C++: Handle error cases with proper DOMException types",
          "passes": false
        },
        {
          "id": "ImageDecoder.reset.ts-binding",
          "description": "TS: Wire method to native implementation",
          "passes": false
        },
        {
          "id": "ImageDecoder.reset.test-happy",
          "description": "Test: Write test case for happy path",
          "passes": false
        },
        {
          "id": "ImageDecoder.reset.test-errors",
          "description": "Test: Write test case for error conditions",
          "passes": false
        }
      ],
      "passes": false
    },
    {
      "id": "ImageDecoder.close",
      "category": "method",
      "name": "close()",
      "description": "Immediately aborts all pending work and releases system resources. Close is final.",
      "returnType": "undefined",
      "codeLinks": {
        "declaration": {
          "file": "src/ImageDecoder.h",
          "line": 37
        },
        "implementation": {
          "file": "src/ImageDecoder.cpp",
          "line": 95,
          "endLine": 105
        },
        "tsBinding": {
          "file": "lib/ImageDecoder.ts",
          "line": 63,
          "endLine": 65
        }
      },
      "algorithmRef": "spec/context/ImageDecoder.md#close",
      "algorithmSteps": [
        "Immediately aborts all pending work and releases system resources. Close is final.",
        "When invoked, run the [Close ImageDecoder](#imagedecoder-close-imagedecoder) algorithm with an `[AbortError](https://webidl.spec.whatwg.org/#aborterror)` `[DOMException](https://webidl.spec.whatwg.org/#idl-DOMException)`."
      ],
      "steps": [
        {
          "id": "ImageDecoder.close.cpp-impl",
          "description": "C++: Implement method logic per W3C spec algorithm",
          "passes": false
        },
        {
          "id": "ImageDecoder.close.cpp-errors",
          "description": "C++: Handle error cases with proper DOMException types",
          "passes": false
        },
        {
          "id": "ImageDecoder.close.ts-binding",
          "description": "TS: Wire method to native implementation",
          "passes": false
        },
        {
          "id": "ImageDecoder.close.test-happy",
          "description": "Test: Write test case for happy path",
          "passes": false
        },
        {
          "id": "ImageDecoder.close.test-errors",
          "description": "Test: Write test case for error conditions",
          "passes": false
        }
      ],
      "passes": false
    },
    {
      "id": "ImageDecoder.isTypeSupported",
      "category": "static-method",
      "name": "isTypeSupported(type: DOMString)",
      "description": "Returns a promise indicating whether the provided config is supported by the User Agent.",
      "returnType": "boolean",
      "codeLinks": {
        "declaration": {
          "file": "src/ImageDecoder.h",
          "line": 38
        },
        "implementation": {
          "file": "src/ImageDecoder.cpp",
          "line": 107,
          "endLine": 117
        },
        "tsBinding": {
          "file": "lib/ImageDecoder.ts",
          "line": 67,
          "endLine": 70
        }
      },
      "algorithmRef": "spec/context/ImageDecoder.md#istypesupported",
      "algorithmSteps": [
        "Returns a promise indicating whether the provided config is supported by the User Agent.",
        "When invoked, run these steps:",
        "If type is not a [valid image MIME type](#valid-image-mime-type), return a `[Promise](https://webidl.spec.whatwg.org/#idl-promise)` rejected with `[TypeError](https://webidl.spec.whatwg.org/#exceptiondef-typeerror)`.",
        "Let p be a new `[Promise](https://webidl.spec.whatwg.org/#idl-promise)`.",
        "In parallel, resolve p with the result of running the [Check Type Support](#imagedecoder-check-type-support) algorithm with type.",
        "Return p."
      ],
      "steps": [
        {
          "id": "ImageDecoder.isTypeSupported.cpp-impl",
          "description": "C++: Implement method logic per W3C spec algorithm",
          "passes": false
        },
        {
          "id": "ImageDecoder.isTypeSupported.cpp-errors",
          "description": "C++: Handle error cases with proper DOMException types",
          "passes": false
        },
        {
          "id": "ImageDecoder.isTypeSupported.ts-binding",
          "description": "TS: Wire method to native implementation",
          "passes": false
        },
        {
          "id": "ImageDecoder.isTypeSupported.test-happy",
          "description": "Test: Write test case for happy path",
          "passes": false
        },
        {
          "id": "ImageDecoder.isTypeSupported.test-errors",
          "description": "Test: Write test case for error conditions",
          "passes": false
        }
      ],
      "passes": false
    }
  ]
}